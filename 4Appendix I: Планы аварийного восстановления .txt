Appendix I: –ü–ª–∞–Ω—ã –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (Disaster Recovery)
I.1. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
–£—Ä–æ–≤–µ–Ω—å	–û–ø–∏—Å–∞–Ω–∏–µ	–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (RTO)	–¢–æ—á–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (RPO)
–£—Ä–æ–≤–µ–Ω—å 1	–ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ (1-2 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)	‚â§ 15 –º–∏–Ω—É—Ç	0 –º–∏–Ω—É—Ç (–≥–æ—Ä—è—á–µ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ)
–£—Ä–æ–≤–µ–Ω—å 2	–ü–æ—Ç–µ—Ä—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (–ë–î, MinIO, Elasticsearch)	‚â§ 1 —á–∞—Å–∞	5 –º–∏–Ω—É—Ç (—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)
–£—Ä–æ–≤–µ–Ω—å 3	–ü–æ—Ç–µ—Ä—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã (—Å–±–æ–π —Ö–æ—Å—Ç–∞, –¶–û–î)	‚â§ 4 —á–∞—Å–∞	1 —á–∞—Å (–µ–∂–µ—á–∞—Å–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã)
–£—Ä–æ–≤–µ–Ω—å 4	–ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–π —Å–±–æ–π (–ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è)	‚â§ 24 —á–∞—Å–∞	24 —á–∞—Å–∞ (–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã)
I.2. –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ —É—Ä–æ–≤–Ω—è–º

I.2.1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è 1 (—á–∞—Å—Ç–∏—á–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è)
bash

#!/bin/bash
# recovery-level1.sh

echo "üîß –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è 1: –ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è"

# 1. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
FAILED_SERVICES=$(docker ps --filter "health=unhealthy" --format "{{.Names}}")

for SERVICE in $FAILED_SERVICES; do
    echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ $SERVICE..."
    
    # 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
    docker logs $SERVICE > /tmp/${SERVICE}_crash.log 2>&1
    
    # 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤
    docker compose restart $SERVICE
    
    # 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    timeout 120 bash -c "
        while ! docker ps --filter 'name=$SERVICE' --filter 'health=healthy' | grep -q $SERVICE; do
            sleep 5
            echo -n '.'
        done
    "
    
    if [ $? -eq 0 ]; then
        echo "‚úÖ $SERVICE –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "‚ùå $SERVICE –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —ç—Å–∫–∞–ª–∞—Ü–∏—è –¥–æ —É—Ä–æ–≤–Ω—è 2"
        escalate_to_level2 $SERVICE
    fi
done

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤..."
curl -f http://localhost:8000/api/v1/health || escalate_to_level2 "controller"
curl -f http://localhost:8080/health || escalate_to_level2 "ml-service"

echo "‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è 1 –∑–∞–≤–µ—Ä—à–µ–Ω–æ"

I.2.2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è 2 (–ø–æ—Ç–µ—Ä—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞)
bash

#!/bin/bash
# recovery-level2.sh

SERVICE=$1
BACKUP_TIMESTAMP=$(date +%Y%m%d_%H%M%S)

echo "üö® –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è 2: –ü–æ—Ç–µ—Ä—è $SERVICE"

case $SERVICE in
    postgres)
        echo "üóÑÔ∏è  –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ PostgreSQL..."
        
        # 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
        docker compose stop postgres
        
        # 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞
        SNAPSHOT=$(ls -t /backups/postgres/*.snapshot | head -1)
        
        # 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        docker run --rm \
            -v ${PROJECT_NAME}_postgres_data:/restore \
            -v $(dirname $SNAPSHOT):/backup \
            alpine sh -c "rm -rf /restore/* && tar xzf /backup/$(basename $SNAPSHOT) -C /restore"
        
        # 4. –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
        docker compose up -d postgres
        
        # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
        timeout 300 bash -c '
            while ! docker compose exec -T postgres pg_isready -U zero1; do
                sleep 10
            done
        '
        
        # 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        docker compose exec -T postgres psql -U zero1 -d zero1 -c "SELECT COUNT(*) FROM test_cycles;" || {
            echo "‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö"
            escalate_to_level3 "postgres_data_corrupt"
        }
        ;;
        
    minio)
        echo "ü™£ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ MinIO..."
        
        # –ú–∏–Ω–∏–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        # –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
        docker compose stop minio
        docker compose up -d minio-standby
        
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ endpoint –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
        update_service_endpoint "MINIO_ENDPOINT" "minio-standby:9000"
        ;;
        
    elasticsearch)
        echo "üîç –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ Elasticsearch..."
        
        # 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
        docker compose stop elasticsearch kibana
        
        # 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        docker compose run --rm elasticsearch \
            curl -X POST "localhost:9200/_snapshot/backup_repo/snapshot_$(date +%Y%m%d)/_restore?wait_for_completion=true"
        
        # 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
        docker compose up -d elasticsearch kibana
        
        # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
        curl -f http://localhost:9200/_cluster/health?wait_for_status=yellow&timeout=5m
        ;;
        
    *)
        echo "‚ö†Ô∏è  –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å: $SERVICE"
        escalate_to_level3 "unknown_service_failure"
        ;;
esac

echo "‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ $SERVICE –∑–∞–≤–µ—Ä—à–µ–Ω–æ"

I.2.3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è 3 (–ø–æ–ª–Ω–∞—è –ø–æ—Ç–µ—Ä—è —Å–∏—Å—Ç–µ–º—ã)
bash

#!/bin/bash
# recovery-level3.sh

DISASTER_TYPE=$1
RECOVERY_POINT=$2

echo "üí• –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è 3: $DISASTER_TYPE"

# 1. –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –¶–û–î
activate_dr_site() {
    echo "üåê –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –¶–û–î..."
    
    # DNS –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
    aws route53 change-resource-record-sets \
        --hosted-zone-id Z123456789 \
        --change-batch '{
            "Changes": [{
                "Action": "UPSERT",
                "ResourceRecordSet": {
                    "Name": "zero1-api.example.com",
                    "Type": "A",
                    "TTL": 60,
                    "ResourceRecords": [{"Value": "192.168.100.100"}]
                }
            }]
        }'
    
    # –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ DR-—Å–∞–π—Ç–µ
    ssh dr-site-manager "cd /opt/zero1 && ./deploy.sh production dr"
}

# 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
restore_from_backup() {
    local backup_file=$1
    
    echo "üíæ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞: $backup_file"
    
    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
    aws s3 cp s3://zero1-dr-backups/$backup_file /tmp/recovery.tar.gz
    
    # –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
    tar xzf /tmp/recovery.tar.gz -C /opt/zero1-recovery
    
    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    cp -r /opt/zero1-recovery/config/* /opt/zero1/config/
    cp /opt/zero1-recovery/.env /opt/zero1/
    
    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ volumes
    restore_volumes /opt/zero1-recovery/volumes/
}

# 3. –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∞–≤–∞—Ä–∏–π
case $DISASTER_TYPE in
    "host_failure")
        echo "üñ•Ô∏è  –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è —Ö–æ—Å—Ç–∞..."
        
        # –ó–∞–ø—É—Å–∫ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º –∂–µ–ª–µ–∑–µ
        migrate_to_backup_host
        
        # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞
        restore_from_backup "hourly_$(date +%Y%m%d_%H).tar.gz"
        ;;
        
    "datacenter_outage")
        echo "üè¢ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞–≤–∞—Ä–∏–∏ –¶–û–î..."
        
        activate_dr_site
        
        # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
        LAST_BACKUP=$(aws s3 ls s3://zero1-dr-backups/ | grep daily | tail -1 | awk '{print $4}')
        restore_from_backup $LAST_BACKUP
        ;;
        
    "data_corruption")
        echo "üìõ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–æ—Ä—Ä—É–ø—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö..."
        
        # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
        docker compose down
        
        # –ü–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∏—Å—Ç–æ–≥–æ –±—ç–∫–∞–ø–∞
        find_clean_backup $RECOVERY_POINT
        
        # –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
        restore_from_backup $CLEAN_BACKUP
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        validate_recovered_data
        ;;
        
    "security_breach")
        echo "üîí –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏..."
        
        # 1. –ò–∑–æ–ª—è—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
        iptables -A INPUT -j DROP
        
        # 2. –°–æ–∑–¥–∞–Ω–∏–µ —á–∏—Å—Ç–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
        setup_clean_environment
        
        # 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
        restore_from_backup "verified_$(date -d '7 days ago' +%Y%m%d).tar.gz"
        
        # 4. –°–º–µ–Ω–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–π –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
        rotate_all_secrets
        
        # 5. –ê—É–¥–∏—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
        security_audit_recovered
        ;;
esac

# 4. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
echo "üöÄ –ó–∞–ø—É—Å–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã..."
docker compose up -d

# 5. –í–∞–ª–∏–¥–∞—Ü–∏—è
echo "üîç –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è..."
run_recovery_validation

echo "‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è 3 –∑–∞–≤–µ—Ä—à–µ–Ω–æ"

I.3. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

I.3.1. –ï–∂–µ—á–∞—Å–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã
bash

#!/bin/bash
# backup-hourly.sh

TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backups/hourly/$TIMESTAMP"

echo "üíæ –°–æ–∑–¥–∞–Ω–∏–µ –µ–∂–µ—á–∞—Å–Ω–æ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞..."

# 1. –°–Ω–∞–ø—à–æ—Ç PostgreSQL
docker compose exec -T postgres pg_dumpall -U zero1 | gzip > $BACKUP_DIR/postgres_full.sql.gz

# 2. –°–Ω–∞–ø—à–æ—Ç MinIO –¥–∞–Ω–Ω—ã—Ö
docker compose run --rm mc mirror minio/zero1-artifacts $BACKUP_DIR/minio/

# 3. –°–Ω–∞–ø—à–æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
cp -r /opt/zero1/config $BACKUP_DIR/
cp /opt/zero1/.env $BACKUP_DIR/

# 4. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
find $BACKUP_DIR -type f -exec sha256sum {} \; > $BACKUP_DIR/checksums.sha256

# 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —É–¥–∞–ª–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
aws s3 sync $BACKUP_DIR s3://zero1-backups/hourly/$TIMESTAMP/

# 6. –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (—Ö—Ä–∞–Ω–∏–º 24 —á–∞—Å–∞)
find /backups/hourly/* -mmin +1440 -exec rm -rf {} \;

echo "‚úÖ –ï–∂–µ—á–∞—Å–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç —Å–æ–∑–¥–∞–Ω: $BACKUP_DIR"

I.3.2. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø–æ–ª–Ω—ã–µ –±—ç–∫–∞–ø—ã
bash

#!/bin/bash
# backup-daily.sh

TIMESTAMP=$(date +%Y%m%d)
BACKUP_DIR="/backups/daily/$TIMESTAMP"

echo "üíø –°–æ–∑–¥–∞–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞..."

# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (graceful)
docker compose stop zero1-controller verifier scheduler worker

# 2. –ü–æ–ª–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç Docker volumes
docker run --rm \
    -v ${PROJECT_NAME}_postgres_data:/source_db:ro \
    -v ${PROJECT_NAME}_minio_data:/source_minio:ro \
    -v ${PROJECT_NAME}_elasticsearch_data:/source_es:ro \
    -v $BACKUP_DIR:/backup \
    alpine tar czf /backup/full_system_$TIMESTAMP.tar.gz -C / .

# 3. –°–Ω–∞–ø—à–æ—Ç Elasticsearch indices
curl -X PUT "localhost:9200/_snapshot/backup_repo/snapshot_$TIMESTAMP?wait_for_completion=true"

# 4. –ó–∞–ø–∏—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
docker info > $BACKUP_DIR/system_state.txt
docker compose config > $BACKUP_DIR/compose_state.yml

# 5. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
docker compose start zero1-controller verifier scheduler worker

# 6. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞
gpg --encrypt --recipient backup@zero1.io $BACKUP_DIR/full_system_$TIMESTAMP.tar.gz
aws s3 cp $BACKUP_DIR/full_system_$TIMESTAMP.tar.gz.gpg s3://zero1-dr-backups/daily/

# 7. –†–æ—Ç–∞—Ü–∏—è (—Ö—Ä–∞–Ω–∏–º 30 –¥–Ω–µ–π)
find /backups/daily/* -mtime +30 -exec rm -rf {} \;

echo "‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: $BACKUP_DIR"

I.4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

I.4.1. –ï–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ —É—á–µ–Ω–∏—è DR
yaml

# dr-test-scenario.yml
scenarios:
  - name: "–ü–æ–ª–Ω–∞—è –ø–æ—Ç–µ—Ä—è –¶–û–î"
    steps:
      - step: "–ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–∞–∑"
        action: "simulate_datacenter_outage.sh"
        
      - step: "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å DR-—Å–∞–π—Ç"
        action: "activate_dr_site.sh"
        timeout: "1h"
        
      - step: "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞"
        action: "restore_from_backup.sh --point 24h"
        timeout: "2h"
        
      - step: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å"
        action: "run_dr_validation.sh"
        metrics:
          - "api_response_time < 5s"
          - "data_integrity = 100%"
          - "no_data_loss"
          
  - name: "–ö–æ—Ä—Ä—É–ø—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
    steps:
      - step: "–ò–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä—É–ø—Ü–∏—é"
        action: "corrupt_postgres_tables.sh"
        
      - step: "–û–±–Ω–∞—Ä—É–∂–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É"
        action: "detect_corruption.sh"
        timeout: "15m"
        
      - step: "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
        action: "recover_from_wal.sh"
        timeout: "30m"
        
      - step: "–í–∞–ª–∏–¥–∞—Ü–∏—è"
        action: "validate_recovery.sh"

I.4.2. –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
bash

#!/bin/bash
# dr-metrics.sh

echo "üìä –ú–µ—Ç—Ä–∏–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:"

# 1. –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (RTO)
START_TIME=$(cat /tmp/dr_start_time)
END_TIME=$(date +%s)
RTO=$((END_TIME - START_TIME))

echo "üïí RTO: $RTO —Å–µ–∫—É–Ω–¥"
echo "   –¶–µ–ª–µ–≤–æ–µ: < 4 —á–∞—Å–∞ (14400 —Å–µ–∫—É–Ω–¥)"

if [ $RTO -lt 14400 ]; then
    echo "   ‚úÖ –í –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã"
else
    echo "   ‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–æ"
fi

# 2. –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö (RPO)
LAST_BACKUP_TIME=$(aws s3 ls s3://zero1-backups/daily/ | tail -1 | awk '{print $1" "$2}')
LAST_BACKUP_TS=$(date -d "$LAST_BACKUP_TIME" +%s)
FAILURE_TIME=$(cat /tmp/failure_time)
RPO=$((FAILURE_TIME - LAST_BACKUP_TS))

echo "üíæ RPO: $RPO —Å–µ–∫—É–Ω–¥"
echo "   –¶–µ–ª–µ–≤–æ–µ: < 1 —á–∞—Å (3600 —Å–µ–∫—É–Ω–¥)"

if [ $RPO -lt 3600 ]; then
    echo "   ‚úÖ –í –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã"
else
    echo "   ‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–æ"
fi

# 3. –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
DATA_INTEGRITY=$(check_data_integrity | grep "Integrity check passed" | wc -l)

echo "üîç –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:"
if [ $DATA_INTEGRITY -eq 1 ]; then
    echo "   ‚úÖ 100% —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å"
else
    echo "   ‚ùå –ù–∞—Ä—É—à–µ–Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å"
fi

# 4. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤
SERVICES_TOTAL=$(docker compose ps --services | wc -l)
SERVICES_HEALTHY=$(docker compose ps --services --filter "status=running" | wc -l)
AVAILABILITY=$((SERVICES_HEALTHY * 100 / SERVICES_TOTAL))

echo "üåê –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤: $AVAILABILITY%"
echo "   –¶–µ–ª–µ–≤–æ–µ: > 99.9%"

# 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
generate_dr_report $RTO $RPO $DATA_INTEGRITY $AVAILABILITY

Appendix J: –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
J.1. OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
yaml

openapi: 3.0.3
info:
  title: Project ZERO-1 API
  version: 1.0.0
  description: API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–º–∏ —Ü–∏–∫–ª–∞–º–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

servers:
  - url: http://localhost:8000/api/v1
    description: –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      
  schemas:
    Cycle:
      type: object
      required:
        - cycle_id
        - stig_id
        - target_device
      properties:
        cycle_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        stig_id:
          type: string
          example: "V-220668"
        target_device:
          $ref: '#/components/schemas/Device'
        status:
          type: string
          enum: [pending, running, completed, failed, rollback]
        created_at:
          type: string
          format: date-time
        artifacts:
          type: array
          items:
            $ref: '#/components/schemas/Artifact'
            
    Device:
      type: object
      properties:
        ip_address:
          type: string
          format: ipv4
        model:
          type: string
        credentials_ref:
          type: string
          description: –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ–∫—Ä–µ—Ç –≤ Vault
          
    Artifact:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum: [config, log, report, proof]
        storage_path:
          type: string
        sha256:
          type: string
        created_at:
          type: string
          format: date-time

paths:
  /cycles:
    post:
      summary: –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - stig_id
                - target_device
              properties:
                stig_id:
                  type: string
                target_device:
                  $ref: '#/components/schemas/Device'
                priority:
                  type: string
                  enum: [low, normal, high]
                  default: normal
      responses:
        '202':
          description: –¶–∏–∫–ª –ø—Ä–∏–Ω—è—Ç –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É
          content:
            application/json:
              schema:
                type: object
                properties:
                  cycle_id:
                    type: string
                    format: uuid
                  status_url:
                    type: string
                    example: "/api/v1/cycles/{cycle_id}/status"
                    
  /cycles/{cycle_id}:
    get:
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ü–∏–∫–ª–µ
      parameters:
        - name: cycle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ü–∏–∫–ª–µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cycle'
                
    delete:
      summary: –û—Ç–º–µ–Ω–∞ —Ü–∏–∫–ª–∞
      parameters:
        - name: cycle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '202':
          description: –¶–∏–∫–ª –æ—Ç–º–µ–Ω–µ–Ω
          
  /cycles/{cycle_id}/status:
    get:
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ü–∏–∫–ª–∞
      parameters:
        - name: cycle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: –°—Ç–∞—Ç—É—Å —Ü–∏–∫–ª–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  current_stage:
                    type: string
                  progress:
                    type: number
                    minimum: 0
                    maximum: 100
                  estimated_completion:
                    type: string
                    format: date-time
                    
  /cycles/{cycle_id}/artifacts:
    get:
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Ü–∏–∫–ª–∞
      parameters:
        - name: cycle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: artifact_type
          in: query
          schema:
            type: string
      responses:
        '200':
          description: –°–ø–∏—Å–æ–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Artifact'
                  
  /cycles/{cycle_id}/report:
    get:
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
      parameters:
        - name: cycle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
          content:
            application/json:
              schema:
                type: object
                properties:
                  cycle_id:
                    type: string
                  verification_result:
                    type: boolean
                  merkle_root:
                    type: string
                  digital_signature:
                    type: string
                  artifacts_summary:
                    type: object
                    
  /health:
    get:
      summary: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
      responses:
        '200':
          description: –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [healthy, degraded, unhealthy]
                  components:
                    type: object
                  uptime:
                    type: number
                  timestamp:
                    type: string
                    format: date-time
                    
  /metrics:
    get:
      summary: –ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã
      responses:
        '200':
          description: –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
          
  /admin/backup:
    post:
      summary: –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å —Ä—É—á–Ω–æ–π –±—ç–∫–∞–ø
      security:
        - bearerAuth: []
      responses:
        '202':
          description: –ë—ç–∫–∞–ø –Ω–∞—á–∞—Ç
          
  /admin/restore:
    post:
      summary: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - backup_id
              properties:
                backup_id:
                  type: string
                validate_only:
                  type: boolean
                  default: false
      responses:
        '202':
          description: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞—Ç–æ

J.2. API –¥–ª—è ML-—Å–µ—Ä–≤–∏—Å–∞
yaml

openapi: 3.0.3
info:
  title: ZERO-1 ML Service API
  version: 1.0.0

paths:
  /analyze:
    post:
      summary: –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - device_config
                - stig_reference
              properties:
                device_config:
                  type: object
                  description: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                stig_reference:
                  type: string
                  description: ID –ø—Ä–æ–≤–µ—Ä–∫–∏ STIG
                context:
                  type: object
                  description: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
      responses:
        '200':
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  findings:
                    type: array
                    items:
                      $ref: '#/components/schemas/Finding'
                  attack_plan:
                    $ref: '#/components/schemas/AttackPlan'
                  confidence:
                    type: number
                    minimum: 0
                    maximum: 1
                    
  /remediate:
    post:
      summary: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - finding
                - device_config
              properties:
                finding:
                  $ref: '#/components/schemas/Finding'
                device_config:
                  type: object
                constraints:
                  type: object
                  properties:
                    allowed_commands:
                      type: array
                      items:
                        type: string
                    maintenance_window:
                      type: object
      responses:
        '200':
          description: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  remediation:
                    type: array
                    items:
                      type: string
                  validation_script:
                    type: string
                  rollback_commands:
                    type: array
                    items:
                      type: string
                  estimated_risk:
                    type: string
                    enum: [low, medium, high]

  /models:
    get:
      summary: –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
      responses:
        '200':
          description: –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
          content:
            application/json:
              schema:
                type: object
                properties:
                  models:
                    type: array
                    items:
                      $ref: '#/components/schemas/ModelInfo'
                  
  /models/{model_id}/fine-tune:
    post:
      summary: –î–æ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
      parameters:
        - name: model_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                dataset:
                  type: string
                  format: binary
                parameters:
                  type: object
      responses:
        '202':
          description: –î–æ–æ–±—É—á–µ–Ω–∏–µ –Ω–∞—á–∞—Ç–æ
          
components:
  schemas:
    Finding:
      type: object
      properties:
        stig_id:
          type: string
        description:
          type: string
        severity:
          type: string
          enum: [low, medium, high, critical]
        affected_components:
          type: array
          items:
            type: string
            
    AttackPlan:
      type: object
      properties:
        steps:
          type: array
          items:
            $ref: '#/components/schemas/AttackStep'
        estimated_success_rate:
          type: number
          
    AttackStep:
      type: object
      properties:
        technique_id:
          type: string
        command:
          type: string
        prerequisites:
          type: array
          items:
            type: string
            
    ModelInfo:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        type:
          type: string
          enum: [analyzer, remediator]
        version:
          type: string
        accuracy:
          type: number

J.3. WebSocket API –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
javascript

// WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
const ws = new WebSocket('ws://localhost:8000/ws/cycles');

ws.onopen = () => {
    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è —Ü–∏–∫–ª–∞
    ws.send(JSON.stringify({
        action: 'subscribe',
        cycle_id: '123e4567-e89b-12d3-a456-426614174000'
    }));
};

ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    
    switch(data.type) {
        case 'stage_update':
            console.log(`–°—Ç–∞–¥–∏—è: ${data.stage}, –ü—Ä–æ–≥—Ä–µ—Å—Å: ${data.progress}%`);
            break;
            
        case 'artifact_created':
            console.log(`–°–æ–∑–¥–∞–Ω –∞—Ä—Ç–µ—Ñ–∞–∫—Ç: ${data.artifact_type}`);
            break;
            
        case 'verification_result':
            console.log(`–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏: ${data.success ? '–£—Å–ø–µ—Ö' : '–ù–µ—É–¥–∞—á–∞'}`);
            break;
            
        case 'error':
            console.error(`–û—à–∏–±–∫–∞: ${data.message}`);
            break;
    }
};

// –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
const WS_EVENTS = {
    CYCLE_STARTED: 'cycle_started',
    STAGE_STARTED: 'stage_started',
    STAGE_COMPLETED: 'stage_completed',
    ARTIFACT_CREATED: 'artifact_created',
    VERIFICATION_RESULT: 'verification_result',
    CYCLE_COMPLETED: 'cycle_completed',
    ERROR_OCCURRED: 'error'
};
